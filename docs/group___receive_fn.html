<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=9"/>
  <meta name="generator" content="Doxygen 1.8.15"/>
  <title>Wireless - Harmony 3: recv</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="customstylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
 <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
 <div id="titlearea">
 <table cellspacing="0" cellpadding="0">
 <tbody>
   <tr style="height: 56px;vertical-align: text-bottom;">
    <td style="padding: 0.2em 0.5em 0.1em 0.5em;">
	  <a id="projectlogo"><img alt="Logo" src="Microchip_logo.png"/> </a> </td>
     <td style="padding-right: 1em;">
       <span id="projectname"/> <class="stringliteral">Wireless - Harmony 3 </span>
     </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">recv<div class="ingroups"><a class="el" href="group___socket_header.html">Socket</a> &#124; <a class="el" href="group___s_o_c_k_e_t_a_p_i.html">SOCKET</a> &raquo; <a class="el" href="group___socket_a_p_i.html">Function</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gac6bf2ee6fc5c39550553c358a4228c2f"><td class="memItemLeft" align="right" valign="top">int16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___receive_fn.html#gac6bf2ee6fc5c39550553c358a4228c2f">recv</a> (<a class="el" href="group___socket_enums.html#ga2faec34c3ab009cb46027b818c0b0d06">SOCKET</a> sock, void *pvRecvBuf, uint16_t u16BufLen, uint32_t u32Timeoutmsec)</td></tr>
<tr class="separator:gac6bf2ee6fc5c39550553c358a4228c2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>An asynchronous receive function, used to retrieve data from a TCP stream. Before calling the recv function, a successful socket connection status must have been received through any of the two socket events <a class="el" href="group___async_callback.html#gga7d04327752aa83113ca666bfb390e5c6ad026eed3b54701f8d052add4b4f547a5">SOCKET_MSG_CONNECT</a> or <a class="el" href="group___async_callback.html#gga7d04327752aa83113ca666bfb390e5c6a946070427c7852024b5fde29a591a682">SOCKET_MSG_ACCEPT</a>, from the socket callback. Hence, indicating that the socket is already connected to a remote host. The application receives the required data in response to this asynchronous call through the reception of the event <a class="el" href="group___async_callback.html#gga7d04327752aa83113ca666bfb390e5c6a3dd1782ab9b12ffa5ebabb1054140133">SOCKET_MSG_RECV</a> in the socket callback.</p>
<p>Receiving the SOCKET_MSG_RECV message in the callback with zero or negative buffer length indicates the following: <a class="el" href="group___socket_error_code.html#ga3d22d700a5ecefd5027c0f3c923ee095">SOCK_ERR_NO_ERROR</a> : Socket connection closed. The application should now call <a class="el" href="group___close_socket_fn.html#gad86fd90d573b4e90789717f597f4af6a">shutdown()</a>. <a class="el" href="group___socket_error_code.html#ga01823c4a616a2473abb8f3f8417c1df8">SOCK_ERR_CONN_ABORTED</a> : Socket connection aborted. The application should now call <a class="el" href="group___close_socket_fn.html#gad86fd90d573b4e90789717f597f4af6a">shutdown()</a>. <a class="el" href="group___socket_error_code.html#ga718ed6a0a949466e5dc13431e0a2f9a4">SOCK_ERR_TIMEOUT</a> : Socket receive timed out. The socket connection remains open. The application code is expected to shutdown the socket through the call to the <a class="el" href="group___close_socket_fn.html#gad86fd90d573b4e90789717f597f4af6a">shutdown</a> function upon the appearance of the above mentioned errors. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="gac6bf2ee6fc5c39550553c358a4228c2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac6bf2ee6fc5c39550553c358a4228c2f">&#9670;&nbsp;</a></span>recv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int16_t recv </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group___socket_enums.html#ga2faec34c3ab009cb46027b818c0b0d06">SOCKET</a>&#160;</td>
          <td class="paramname"><em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvRecvBuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>u16BufLen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>u32Timeoutmsec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sock</td><td>Socket ID, must hold a non negative value. A negative value will return a socket error <a class="el" href="group___socket_error_code.html#ga4889a7ecf9dcfb3208d6f7c59b691d9d">SOCK_ERR_INVALID_ARG</a>. Indicating that an invalid argument is passed in.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pvRecvBuf</td><td>Pointer to a buffer that will hold the received data. The buffer is used in the recv callback to deliver the received data to the caller. The buffer must be resident in memory (heap or global buffer).</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u16BufLen</td><td>The buffer size in bytes.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u32Timeoutmsec</td><td>Timeout for the recv function in milli-seconds. If the value is set to ZERO, the timeout will be set to infinite (the recv function waits forever). If the timeout period is elapsed with no data received, the socket will get a timeout error. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section pre"><dt>Precondition</dt><dd><ul>
<li>The socket function must be called to allocate a TCP socket before passing the socket ID to the recv function.</li>
<li>The socket in a connected state is expected to receive data through the socket interface.</li>
</ul>
</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group___socket_a_p_i.html#ga3af525e03c1d87e1c38bc80707cc96b9">socket</a> </dd>
<dd>
<a class="el" href="group___socket_a_p_i.html#ga459851d89ff927827263db7a6e7a05b8">connect</a> </dd>
<dd>
<a class="el" href="group___socket_a_p_i.html#gaad1c6d98b22166914c734145e37e1b72">bind</a> </dd>
<dd>
<a class="el" href="group___socket_a_p_i.html#ga4294a09e9618e0505d6adbd7cb9b77e4">listen</a> </dd>
<dd>
<a class="el" href="group___socket_a_p_i.html#ga16804704d87511f43b63c8df9cb5c3b3">recvfrom</a> </dd>
<dd>
<a class="el" href="group___socket_a_p_i.html#gad86fd90d573b4e90789717f597f4af6a">shutdown</a></dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns ZERO for successful operations and a negative value otherwise. The possible error values are:<ul>
<li><a class="el" href="group___socket_error_code.html#ga3d22d700a5ecefd5027c0f3c923ee095">SOCK_ERR_NO_ERROR</a> Indicating that the operation was successful.</li>
<li><a class="el" href="group___socket_error_code.html#ga4889a7ecf9dcfb3208d6f7c59b691d9d">SOCK_ERR_INVALID_ARG</a> Indicating passing invalid arguments such as negative socket ID or NULL Receive buffer.</li>
<li><a class="el" href="group___socket_error_code.html#ga327a62f01f2b0d7b732bea32612acc42">SOCK_ERR_BUFFER_FULL</a> Indicate socket receive failure. </li>
</ul>
</dd></dl>
<h1><a class="anchor" id="recv"></a>
example</h1>
<p>The example demonstrates a code snippet for the calling of the recv function in the socket callback upon notification of the accept or connect events, and the parsing of the received data when the <a class="el" href="group___async_callback.html#gga7d04327752aa83113ca666bfb390e5c6a3dd1782ab9b12ffa5ebabb1054140133">SOCKET_MSG_RECV</a> event is received. </p><div class="fragment"><div class="line">    <span class="keywordflow">switch</span>(u8Msg)</div><div class="line">    {</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___async_callback.html#gga7d04327752aa83113ca666bfb390e5c6a946070427c7852024b5fde29a591a682">SOCKET_MSG_ACCEPT</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="structtstr_socket_accept_msg.html">tstrSocketAcceptMsg</a> *pstrAccept = (<a class="code" href="structtstr_socket_accept_msg.html">tstrSocketAcceptMsg</a>*)pvMsg;</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span>(pstrAccept-&gt;<a class="code" href="structtstr_socket_accept_msg.html#a9ecd3f07483bb5a5dd0cef66ed283483">sock</a> &gt;= 0)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___receive_fn.html#gac6bf2ee6fc5c39550553c358a4228c2f">recv</a>(pstrAccept-&gt;<a class="code" href="structtstr_socket_accept_msg.html#a9ecd3f07483bb5a5dd0cef66ed283483">sock</a>,gau8RxBuffer,<span class="keyword">sizeof</span>(gau8RxBuffer),TEST_RECV_TIMEOUT);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                <a class="code" href="group___debug_defines.html#ga34d005df494e50b05cd38b80f318d7ac">M2M_ERR</a>(<span class="stringliteral">&quot;accept\n&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___async_callback.html#gga7d04327752aa83113ca666bfb390e5c6a3dd1782ab9b12ffa5ebabb1054140133">SOCKET_MSG_RECV</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="structtstr_socket_recv_msg.html">tstrSocketRecvMsg</a>   *pstrRx = (<a class="code" href="structtstr_socket_recv_msg.html">tstrSocketRecvMsg</a>*)pvMsg;</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span>(pstrRx-&gt;<a class="code" href="structtstr_socket_recv_msg.html#ae16c70a8aed54721e20af4f68fdfc51d">s16BufferSize</a> &gt; 0)</div><div class="line">            {</div><div class="line">                <a class="code" href="group___receive_fn.html#gac6bf2ee6fc5c39550553c358a4228c2f">recv</a>(sock,gau8RxBuffer,<span class="keyword">sizeof</span>(gau8RxBuffer),TEST_RECV_TIMEOUT);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                printf(<span class="stringliteral">&quot;Socket recv Error: %d\n&quot;</span>,pstrRx-&gt;<a class="code" href="structtstr_socket_recv_msg.html#ae16c70a8aed54721e20af4f68fdfc51d">s16BufferSize</a>);</div><div class="line">                <a class="code" href="group___close_socket_fn.html#gad86fd90d573b4e90789717f597f4af6a">shutdown</a>(sock);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>An asynchronous receive function, used to retrieve data from a TCP stream. Before calling the recv function, a successful socket connection status must have been received through any of the two socket events [SOCKET_MSG_CONNECT] or [SOCKET_MSG_ACCEPT], from the socket callback. Hence, indicating that the socket is already connected to a remote host. The application receives the required data in response to this asynchronous call through the reception of the event <a class="el" href="group___async_callback.html#gga7d04327752aa83113ca666bfb390e5c6a3dd1782ab9b12ffa5ebabb1054140133">SOCKET_MSG_RECV</a> in the socket callback.</p>
<p>Receiving the SOCKET_MSG_RECV message in the callback with zero or negative buffer length indicates the following:</p><ul>
<li><a class="el" href="group___socket_error_code.html#ga3d22d700a5ecefd5027c0f3c923ee095">SOCK_ERR_NO_ERROR</a> : Socket connection closed. The application should now call <a class="el" href="group___close_socket_fn.html#gad86fd90d573b4e90789717f597f4af6a">shutdown()</a>.</li>
<li><a class="el" href="group___socket_error_code.html#ga01823c4a616a2473abb8f3f8417c1df8">SOCK_ERR_CONN_ABORTED</a> : Socket connection aborted. The application should now call <a class="el" href="group___close_socket_fn.html#gad86fd90d573b4e90789717f597f4af6a">shutdown()</a>.</li>
<li><a class="el" href="group___socket_error_code.html#ga718ed6a0a949466e5dc13431e0a2f9a4">SOCK_ERR_TIMEOUT</a> : Socket receive timed out. The socket connection remains open.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sock</td><td>Socket ID, must hold a non negative value. A negative value will return a socket error <a class="el" href="group___socket_error_code.html#ga4889a7ecf9dcfb3208d6f7c59b691d9d">SOCK_ERR_INVALID_ARG</a>. Indicating that an invalid argument is passed in.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pvRecvBuf</td><td>Pointer to a buffer that will hold the received data. The buffer is used in the recv callback to deliver the received data to the caller. The buffer must be resident in memory (heap or global buffer).</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u16BufLen</td><td>The buffer size in bytes.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u32Timeoutmsec</td><td>Timeout for the recv function in milli-seconds. If the value is set to ZERO, the timeout will be set to infinite (the recv function waits forever). If the timeout period is elapsed with no data received, the socket will get a timeout error. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section pre"><dt>Precondition</dt><dd><ul>
<li>The socket function must be called to allocate a TCP socket before passing the socket ID to the recv function.</li>
<li>The socket in a connected state is expected to receive data through the socket interface.</li>
</ul>
</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group___socket_a_p_i.html#ga3af525e03c1d87e1c38bc80707cc96b9">socket</a> </dd>
<dd>
<a class="el" href="group___socket_a_p_i.html#ga459851d89ff927827263db7a6e7a05b8">connect</a> </dd>
<dd>
<a class="el" href="group___socket_a_p_i.html#gaad1c6d98b22166914c734145e37e1b72">bind</a> </dd>
<dd>
<a class="el" href="group___socket_a_p_i.html#ga4294a09e9618e0505d6adbd7cb9b77e4">listen</a> </dd>
<dd>
<a class="el" href="group___socket_a_p_i.html#ga16804704d87511f43b63c8df9cb5c3b3">recvfrom</a> </dd>
<dd>
<a class="el" href="group___socket_a_p_i.html#gad86fd90d573b4e90789717f597f4af6a">shutdown</a></dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns ZERO for successful operations and a negative value otherwise. The possible error values are:<ul>
<li><a class="el" href="group___socket_error_code.html#ga3d22d700a5ecefd5027c0f3c923ee095">SOCK_ERR_NO_ERROR</a> Indicating that the operation was successful.</li>
<li><a class="el" href="group___socket_error_code.html#ga4889a7ecf9dcfb3208d6f7c59b691d9d">SOCK_ERR_INVALID_ARG</a> Indicating passing invalid arguments such as negative socket ID or NULL receive buffer.</li>
<li><a class="el" href="group___socket_error_code.html#ga327a62f01f2b0d7b732bea32612acc42">SOCK_ERR_BUFFER_FULL</a> Indicate socket receive failure. </li>
</ul>
</dd></dl>
<h1><a class="anchor" id="SocketExample7"></a>
Example</h1>
<p>The example demonstrates a code snippet for the calling of the recv function in the socket callback upon notification of the accept or connect events, and the parsing of the received data when the SOCKET_MSG_RECV event is received. </p><div class="fragment"><div class="line"><span class="keywordflow">switch</span>(u8Msg)</div><div class="line">{</div><div class="line"></div><div class="line"><span class="keywordflow">case</span> <a class="code" href="group___async_callback.html#gga7d04327752aa83113ca666bfb390e5c6a946070427c7852024b5fde29a591a682">SOCKET_MSG_ACCEPT</a>:</div><div class="line">    {</div><div class="line">        <a class="code" href="structtstr_socket_accept_msg.html">tstrSocketAcceptMsg</a> *pstrAccept = (<a class="code" href="structtstr_socket_accept_msg.html">tstrSocketAcceptMsg</a>*)pvMsg;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(pstrAccept-&gt;<a class="code" href="structtstr_socket_accept_msg.html#a9ecd3f07483bb5a5dd0cef66ed283483">sock</a> &gt;= 0)</div><div class="line">        {</div><div class="line">            <a class="code" href="group___receive_fn.html#gac6bf2ee6fc5c39550553c358a4228c2f">recv</a>(pstrAccept-&gt;<a class="code" href="structtstr_socket_accept_msg.html#a9ecd3f07483bb5a5dd0cef66ed283483">sock</a>,gau8RxBuffer,<span class="keyword">sizeof</span>(gau8RxBuffer),TEST_RECV_TIMEOUT);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            <a class="code" href="group___debug_defines.html#ga34d005df494e50b05cd38b80f318d7ac">M2M_ERR</a>(<span class="stringliteral">&quot;accept\n&quot;</span>);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">case</span> <a class="code" href="group___async_callback.html#gga7d04327752aa83113ca666bfb390e5c6a3dd1782ab9b12ffa5ebabb1054140133">SOCKET_MSG_RECV</a>:</div><div class="line">    {</div><div class="line">        <a class="code" href="structtstr_socket_recv_msg.html">tstrSocketRecvMsg</a>   *pstrRx = (<a class="code" href="structtstr_socket_recv_msg.html">tstrSocketRecvMsg</a>*)pvMsg;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(pstrRx-&gt;<a class="code" href="structtstr_socket_recv_msg.html#ae16c70a8aed54721e20af4f68fdfc51d">s16BufferSize</a> &gt; 0)</div><div class="line">        {</div><div class="line"></div><div class="line">            <a class="code" href="group___receive_fn.html#gac6bf2ee6fc5c39550553c358a4228c2f">recv</a>(sock,gau8RxBuffer,<span class="keyword">sizeof</span>(gau8RxBuffer),TEST_RECV_TIMEOUT);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            printf(<span class="stringliteral">&quot;Socet recv Error: %d\n&quot;</span>,pstrRx-&gt;<a class="code" href="structtstr_socket_recv_msg.html#ae16c70a8aed54721e20af4f68fdfc51d">s16BufferSize</a>);</div><div class="line">            <a class="code" href="group___close_socket_fn.html#gad86fd90d573b4e90789717f597f4af6a">shutdown</a>(sock);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">default</span>:</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">}</div></div><!-- fragment --> 
</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer">
  <span class="stringliteral"> © 2019 Microchip Technology Inc. </span>
</body>
</html>
